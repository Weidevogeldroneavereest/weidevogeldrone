<script>
  document.getElementById('logForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const name = document.getElementById('deviceName').value;
    const isoTime = new Date().toISOString();
    let lat = '', lon = '';

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async position => {
        lat = position.coords.latitude;
        lon = position.coords.longitude;
        console.log("üìç Locatie opgehaald:", lat, lon);
        await sendToSheet(name, isoTime, lat, lon);
      }, () => {
        document.getElementById('status').textContent = 'üìç Locatie niet beschikbaar';
        console.warn("‚ö†Ô∏è Geolocatie mislukt");
        sendToSheet(name, isoTime, '', '');
      });
    } else {
      document.getElementById('status').textContent = 'üåê Geolocatie niet ondersteund';
      console.warn("‚ö†Ô∏è Geolocatie niet ondersteund door browser");
      sendToSheet(name, isoTime, '', '');
    }
  });

  async function sendToSheet(name, time, lat, lon) {
    const url = 'https://script.google.com/macros/s/AKfycbybHQrNWIhgXxyN-q8mkGm_0n1dGeoEgqmne8Kmms1uLL7zMgHC21EylWEVjTtR41A2/exec';

    const payload = {
      naam: name,
      tijd: time,
      locatie: lat && lon ? `${lat}, ${lon}` : ''
    };

    console.log("üì¶ Payload naar Google Script:", payload);

    try {
      await fetch(url, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      document.getElementById('status').textContent = '‚úÖ Gegevens verstuurd!';
      console.log("‚úÖ Verzoek verzonden");
    } catch (error) {
      document.getElementById('status').textContent = '‚ùå Fout bij verzenden';
      console.error("‚ùå Fout bij fetch:", error);
    }
  }
</script>
