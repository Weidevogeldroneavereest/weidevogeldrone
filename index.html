<script>
  document.getElementById('logForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const deviceName = document.getElementById('deviceName').value;
    const timestamp = new Date();
    const isoTime = timestamp.toISOString(); // Wordt in script gesplitst

    let lat = '', lon = '';

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async function(position) {
        lat = position.coords.latitude;
        lon = position.coords.longitude;
        await sendToSheet(deviceName, isoTime, lat, lon);
      }, function() {
        document.getElementById('status').textContent = 'Locatie niet beschikbaar.';
        sendToSheet(deviceName, isoTime, '', '');
      });
    } else {
      document.getElementById('status').textContent = 'Geolocatie wordt niet ondersteund.';
      sendToSheet(deviceName, isoTime, '', '');
    }
  });

  async function sendToSheet(name, isoTime, latitude, longitude) {
    const url = 'https://script.google.com/macros/s/AKfycbybHQrNWIhgXxyN-q8mkGm_0n1dGeoEgqmne8Kmms1uLL7zMgHC21EylWEVjTtR41A2/exec'; // Vervang met je echte URL

    const data = {
      naam: name,
      tijd: isoTime,
      locatie: latitude && longitude ? `${latitude}, ${longitude}` : ''
    };

    try {
      await fetch(url, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      document.getElementById('status').textContent = '✅ Gegevens succesvol verzonden!';
    } catch (error) {
      document.getElementById('status').textContent = '❌ Fout bij verzenden.';
    }
  }
</script>
